(function(){function x(g){(function(a){function g(){a("object.cgmp-json-string-placeholder").each(function(k,c){var b=a(c).attr("id"),b=a(c).find("param#json-string-"+b).val(),b=p.searchReplace(b,"'",""),b=b.replace("&quot;",""),b=y(b);if("undefined"==typeof b||!b)return!1;if(0<a("div#"+b.id).length){var M=new google.maps.Map(document.getElementById(b.id));r.initMap(M,b.bubbleautopan,parseInt(b.zoom),b.maptype);s.init(M);var l=new x;l.init(M,b.bubbleautopan);r.setMapControls({mapTypeControl:"true"===
b.maptypecontrol,panControl:"true"===b.pancontrol,zoomControl:"true"===b.zoomcontrol,scaleControl:"true"===b.scalecontrol,scrollwheel:"true"===b.scrollwheelcontrol,streetViewControl:"true"===b.streetviewcontrol,tilt:"true"===b.tiltfourtyfive?45:null,draggable:"true"===b.draggable,overviewMapControl:!0,overviewMapControlOptions:{opened:!1}});"true"===b.showpanoramio&&s.buildPanoramioLayer(b.panoramiouid);"true"===b.showbike&&s.buildBikeLayer();"true"===b.showtraffic&&s.buildTrafficLayer();null!=b.kml&&
""!=p.trim(b.kml)?s.buildKmlLayer(b.kml):(null!=b.markerlist&&""!=p.trim(b.markerlist)&&l.buildAddressMarkers(b.markerlist,b.addmarkermashup,b.addmarkermashupbubble),l.isBuildAddressMarkersCalled()||F.alertError(d.errors.msgMissingMarkers))}})}var y=function(a){u.fatal("Using parseJson stub..")};1.4<=parseFloat(a.fn.jquery)?y=a.parseJSON:window.JSON&&window.JSON.parse&&(y=window.JSON.parse);var d={},r=function(){var a={};return{initMap:function(c,b,d,l){a=c;c=[];for(var g in google.maps.MapTypeId)c.push(google.maps.MapTypeId[g]);
"OSM"==l?(c.push(l),a.mapTypes.set(l,new google.maps.ImageMapType({getTileUrl:function(a,b){return"http://tile.openstreetmap.org/"+b+"/"+a.x+"/"+a.y+".png"},tileSize:new google.maps.Size(256,256),name:"OpenStreet",maxZoom:20}))):"ROADMAP"==l?l=google.maps.MapTypeId.ROADMAP:"SATELLITE"==l?l=google.maps.MapTypeId.SATELLITE:"HYBRID"==l?l=google.maps.MapTypeId.HYBRID:"TERRAIN"==l&&(l=google.maps.MapTypeId.TERRAIN);a.setOptions({zoom:d,mapTypeId:l,mapTypeControlOptions:{mapTypeIds:c}})},setMapControls:function(c){a.setOptions(c)}}}(),
s=function(){var a={};return{init:function(c){a=c},buildKmlLayer:function(c){if(0>c.toLowerCase().indexOf("http"))return u.error("KML URL must start with HTTP(S). Aborting.."),!1;var b=new google.maps.KmlLayer(c);google.maps.event.addListener(b,"status_changed",function(){var a=b.getStatus();if(a!=google.maps.KmlLayerStatus.OK){var c="";switch(a){case google.maps.KmlLayerStatus.DOCUMENT_NOT_FOUND:c=d.errors.kmlNotFound;break;case google.maps.KmlLayerStatus.DOCUMENT_TOO_LARGE:c=d.errors.kmlTooLarge;
break;case google.maps.KmlLayerStatus.FETCH_ERROR:c=d.errors.kmlFetchError;break;case google.maps.KmlLayerStatus.INVALID_DOCUMENT:c=d.errors.kmlDocInvalid;break;case google.maps.KmlLayerStatus.INVALID_REQUEST:c=d.errors.kmlRequestInvalid;break;case google.maps.KmlLayerStatus.LIMITS_EXCEEDED:c=d.errors.kmlLimits;break;case google.maps.KmlLayerStatus.TIMED_OUT:c=d.errors.kmlTimedOut;break;case google.maps.KmlLayerStatus.UNKNOWN:c=d.errors.kmlUnknown}if(""!=c){var k=d.errors.kml.replace("[MSG]",c),k=
k.replace("[STATUS]",a);F.alertError(k);u.error("Google returned KML error: "+c+" ("+a+")");u.error("KML file: "+b.getUrl())}}});google.maps.event.addListener(b,"defaultviewport_changed",function(){});b.setMap(a)},buildTrafficLayer:function(){(new google.maps.TrafficLayer).setMap(a)},buildBikeLayer:function(){(new google.maps.BicyclingLayer).setMap(a)},buildPanoramioLayer:function(c){if("undefined"==typeof google.maps.panoramio||!google.maps.panoramio||null==google.maps.panoramio)return u.error("We cannot access Panoramio library. Aborting.."),
!1;var b=new google.maps.panoramio.PanoramioLayer;b?(null!=c&&""!=c&&b.setUserId(c),b.setMap(a)):u.error("Could not instantiate Panoramio object. Aborting..")}}}(),x=function(){function k(){null!=z?n.getCenter()!=z.getCenter()&&(n.fitBounds(z),n.setCenter(z.getCenter())):null!=J&&(n.setCenter(J),n.setZoom(N))}function c(f){a(f+" input#a_address").val("");a(f+" input#b_address").val("");a(f+" input#a_address").removeClass("d_error");a(f+" input#b_address").removeClass("d_error")}function b(f,m){var h=
q(f.content,m),e="div#direction-controls-placeholder-"+v,b=a("div#rendered-directions-placeholder-"+v);google.maps.event.addListener(f,"click",function(){c(e);a(e).fadeOut();A.setMap(null);b.html("");b.hide();a(e+" button#print_sub").hide();l(f,h,e);g(f,h,e,b);w.setContent(h.bubbleContent);w.setOptions({disableAutoPan:"true"==R?!1:!0});w.open(n,this)})}function g(f,m,h,e){var b="div#bubble-"+m.bubbleHolderId,d=f.content,d=d.replace("Lat/Long: ","");a(b+" a.dirToHereTrigger").live("click",function(){this.id==
"toHere-"+m.bubbleHolderId&&(a(h).fadeIn(),a(h+" input#a_address").val(""),a(h+" input#b_address").val(d),a(h+" input#radio_miles").attr("checked","checked"))});a(b+" a.dirFromHereTrigger").live("click",function(){this.id=="fromHere-"+m.bubbleHolderId&&(a(h).fadeIn(),a(h+" input#a_address").val(d),a(h+" input#b_address").val(""),a(h+" input#radio_miles").attr("checked","checked"))});a(h+" div.d_close-wrapper").live("click",function(f){c(h);a(this).parent().fadeOut();A.setMap(null);e.html("");e.hide();
a(h+" button#print_sub").hide();k();return!1})}function l(f,m,h){S.getPanoramaByLocation(f.position,50,function(e,b){b===google.maps.StreetViewStatus.OK?a("a#trigger-"+m.bubbleHolderId).live("click",function(){var e={navigationControl:!0,enableCloseButton:!0,addressControl:!1,linksControl:!0,scrollwheel:!1,addressControlOptions:{position:google.maps.ControlPosition.BOTTOM},position:f.position,pov:{heading:165,pitch:0,zoom:1}},b=new google.maps.StreetViewPanorama(document.getElementById("bubble-"+
m.bubbleHolderId),e);b.setVisible(!0);google.maps.event.addListener(w,"closeclick",function(){c(h);a(h).fadeOut();null!=b&&(b.unbind("position"),b.setVisible(!1));b=null});google.maps.event.addListener(b,"closeclick",function(){null!=b&&(b.unbind("position"),b.setVisible(!1),a("div#bubble-"+m.bubbleHolderId).css("background","none"));b=null})}):(a("a#trigger-"+m.bubbleHolderId).live("click",function(a){a.preventDefault()}),a("a#trigger-"+m.bubbleHolderId).attr("style","text-decoration: none !important; color: #ddd !important"),
google.maps.event.addListener(w,"domready",function(){a("a#trigger-"+m.bubbleHolderId).removeAttr("href");a("a#trigger-"+m.bubbleHolderId).attr("style","text-decoration: none !important; color: #ddd !important")}))})}function X(){var f="div#direction-controls-placeholder-"+v,b=a("div#rendered-directions-placeholder-"+v);a(f+" a#reverse-btn").live("click",function(b){b=a(f+" input#a_address").val();var e=a(f+" input#b_address").val();a(f+" input#a_address").val(e);a(f+" input#b_address").val(b);return!1});
a(f+" a#d_options_show").live("click",function(){a(f+" a#d_options_hide").show();a(f+" a#d_options_show").hide();a(f+" div#d_options").show();return!1});a(f+" a#d_options_hide").live("click",function(){a(f+" a#d_options_hide").hide();a(f+" a#d_options_show").show();a(f+" div#d_options").hide();a(f+" input#avoid_hway").removeAttr("checked");a(f+" input#avoid_tolls").removeAttr("checked");a(f+" input#radio_km").removeAttr("checked");a(f+" input#radio_miles").attr("checked","checked");return!1});a(f+
" button#d_sub").live("click",function(){var h=a(f+" input#a_address").val(),e=a(f+" input#b_address").val(),c=!1;if(null==h||""==h)a(f+" input#a_address").addClass("d_error"),c=!0;if(null==e||""==e)a(f+" input#b_address").addClass("d_error"),c=!0;if(!c){a(f+" button#d_sub").attr("disabled","disabled").html("Please wait..");var d=google.maps.DirectionsTravelMode.DRIVING;a(f+" a#dir_w_btn").hasClass("selected")&&(d=google.maps.DirectionsTravelMode.WALKING);var c=a(f+" input#avoid_hway").is(":checked"),
k=a(f+" input#avoid_tolls").is(":checked"),g=a(f+" input#radio_miles").is(":checked"),d={origin:h,destination:e,travelMode:d,provideRouteAlternatives:!0};c&&(d.avoidHighways=!0);k&&(d.avoidTolls=!0);d.unitSystem=g?google.maps.DirectionsUnitSystem.IMPERIAL:google.maps.DirectionsUnitSystem.METRIC;T.route(d,function(c,d){d==google.maps.DirectionsStatus.OK?(b.html(""),b.show(),A.setMap(n),A.setDirections(c),a(f+" button#d_sub").removeAttr("disabled").html("Get directions"),a(f+" button#print_sub").fadeIn(),
w.close()):(b.html("<span style='font-size: 12px; font-weight: bold; color: red'>Could not route directions from<br />'"+h+"' to<br />'"+e+"'<br />Got result from Google: ["+d+"]</span>"),a(f+" button#print_sub").hide(),a(f+" button#d_sub").removeAttr("disabled").html("Get directions"))})}});a(f+" button#print_sub").live("click",function(){var b=a(f+" input#a_address").val(),e=a(f+" input#b_address").val(),m="d";a(f+" a#dir_w_btn").hasClass("selected")&&(m="w");b="http://maps.google.com/?saddr="+
b+"&daddr="+e+"&dirflg="+m+"&pw=2";a(f+" input#radio_miles").is(":checked")&&(b+="&doflg=ptm");window.open(b);return!1});a(f+" input#a_address").live("change focus",function(){a(f+" input#a_address").removeClass("d_error");return!1});a(f+" input#b_address").live("change focus",function(){a(f+" input#b_address").removeClass("d_error");return!1});a(f+" .kd-button").live("click",function(){var b=this.id;"dir_d_btn"==b?a(f+" a#dir_d_btn").hasClass("selected")||(a(f+" a#dir_d_btn").addClass("selected"),
a(f+" a#dir_w_btn").removeClass("selected")):"dir_w_btn"!=b||a(f+" a#dir_w_btn").hasClass("selected")||(a(f+" a#dir_w_btn").addClass("selected"),a(f+" a#dir_d_btn").removeClass("selected"));return!1})}function q(a,b){var c=Math.floor(111111*Math.random()),c=c+"-"+v,e="<div id='bubble-"+c+"' style='height: 130px !important; width: 300px !important;' class='bubble-content'>";if(b.geoMashup)var k=b.postTitle.substring(0,30),e=e+""+("<p class='geo-mashup-post-title'><a title='Original post: "+b.postTitle+
"' href='"+b.postLink+"'>"+k+"..</a></p>"),e=e+("<p class='geo-mashup-post-excerpt'>"+b.postExcerpt+"</p>");else e+="<h4>"+d.translations.address+":</h4>",e+="<p class='custom-bubble-text'>"+a+"</p>",""!=b.customBubbleText&&(e+="<p class='custom-bubble-text'>"+b.customBubbleText+"</p>");e+="<div class='custom-bubble-links-section'>";e+="<hr />";e+="<p class='custom-bubble-text'>"+d.translations.directions+": <a id='toHere-"+c+"' class='dirToHereTrigger' href='javascript:void(0);'>"+d.translations.toHere+
"</a> - <a id='fromHere-"+c+"' class='dirFromHereTrigger' href='javascript:void(0);'>"+d.translations.fromHere+"</a> | <a id='trigger-"+c+"' class='streetViewTrigger' href='javascript:void(0);'>"+d.translations.streetView+"</a></p>";e+="</div></div>";return{bubbleHolderId:c,bubbleContent:e}}function Q(b,c){var h=1;a.each(b,function(){null==this.excerpt&&(this.excerpt="");var a=this.addy.split(d.sep);a[0]=this.location;s(h,a,this.title,this.permalink,this.excerpt,c);h++});u.info("Have "+(h-1)+" destinations for marker Geo mashup..")}
function r(a,b,c,e,d,k){null!=b[2]?-1!=b[2].indexOf("No description provided")&&(b[2]=""):b[2]="";G.push({address:b[0],animation:google.maps.Animation.DROP,zIndex:a,markerIcon:b[1],customBubbleText:b[2],postTitle:c,postLink:e,postExcerpt:d,geoMashup:k})}function s(a,b,c,e,d,k){var g=[];-1!=b[0].indexOf(",")?g=b[0].split(","):-1!=b[0].indexOf(";")&&(g=b[0].split(";"));if(0==g.length)return!1;g[0]=p.trim(g[0]);g[1]=p.trim(g[1]);if(""==g[0]||""==g[1])return!1;b[0]=new google.maps.LatLng(parseFloat(g[0]),
parseFloat(g[1]));r(a,b,c,e,d,k)}function B(){clearTimeout(H);if(0<G.length){var b=G.shift();b.address instanceof google.maps.LatLng?x(b):U.geocode({address:b.address},function(a,c){L(a,c,b)})}else{t();if(0<I.length){var c="";a.each(I,function(a,b){c+="&nbsp;&nbsp;&nbsp;<b>"+(1+a)+". "+b+"</b><br />"});F.alertError(d.errors.badAddresses.replace("[REPLACE]",c))}I=[]}}function t(){1<C.length?(a.each(C,function(a,b){D.contains(b.position)||D.extend(b.position)}),z=D,null!=D&&n.fitBounds(D)):1==C.length&&
(n.setCenter(C[0].position),N=n.getZoom(),J=n.getCenter())}function x(a){var b=a.address;a.address="Lat/Long: "+b.lat().toFixed(6)+", "+b.lng().toFixed(6);V(b,a);B()}function L(a,b,c){b==google.maps.GeocoderStatus.OK?(V(a[0].geometry.location,c),H=setTimeout(function(){B()},330)):b==google.maps.GeocoderStatus.OVER_QUERY_LIMIT?(t(),G.push(c),H=setTimeout(function(){B()},3E3)):b==google.maps.GeocoderStatus.ZERO_RESULTS&&(I.push(c.address),H=setTimeout(function(){B()},400))}function V(c,g){var h=new google.maps.Marker({position:c,
title:g.address.replace("<br />"," :: "),content:g.address,zIndex:g.zIndex+1E3,map:n});if(h){if(g.markerIcon){var e=g.markerIcon;if("undefined"==typeof e||"undefined"===e)e="1-default.png";h.setIcon(d.customMarkersUri+e);var k=null,k=["4-default.png","5-default.png","6-default.png","7-default.png"];-1!=a.inArray(e,["1-default.png","2-default.png"])?(e=d.customMarkersUri+"msmarker.shadow.png",k=K(e,59,32,0,0,16,33)):-1!=a.inArray(e,k)?(e=d.customMarkersUri+"msmarker.shadow.png",k=K(e,59,32,0,0,21,
34)):-1!=e.indexOf("3-default")?(e=d.customMarkersUri+"beachflag_shadow.png",k=K(e,37,32,0,0,10,33)):k=K(d.customMarkersUri+"shadow.png",68,37,0,0,32,38);h.setShadow(k)}b(h,g);O||(X(),O=!0);C.push(h)}}function K(a,b,c,e,d,k,g){return new google.maps.MarkerImage(a,new google.maps.Size(b,c),new google.maps.Point(e,d),new google.maps.Point(k,g))}var C,G,I,P,H,O,n,E,R,z,J,N,v,U,D,w,S,A,T;return{init:function(a,b){n=a;v=n.getDiv().id;R=b;google.maps.event.addListener(n,"click",function(){k()});C=[];I=
[];G=[];N=5;z=J=E=H=null;P=O=!1;U=new google.maps.Geocoder;D=new google.maps.LatLngBounds;w=new google.maps.InfoWindow;S=new google.maps.StreetViewService;T=new google.maps.DirectionsService;rendererOptions={draggable:!0};A=new google.maps.DirectionsRenderer(rendererOptions);A.setPanel(document.getElementById("rendered-directions-placeholder-"+v))},buildAddressMarkers:function(a,b,c){P=!0;E=p.trim(a);E=p.searchReplace(E,"'","");if("true"===b)a=y(E),"true"===c?Q(a,!0):"false"===c&&Q(a,!1),B();else if(null==
b||"false"===b){c=E.split("|");for(a=0;a<c.length;a++){var e=c[a];null!=e&&""!=e&&(e=p.trim(e),""!=e&&(b=a+1,e=e.split(d.sep),p.isNumeric(e[0])?s(b,e,"","","",!1):(p.isAlphaNumeric(e[0]),r(b,e,"","","",!1))))}B()}},isBuildAddressMarkersCalled:function(){return P}}},p=function(){return{isNumeric:function(a){return/^([0-9?(\-.,;\s{1,})]+)$/.test(a)},isAlphaNumeric:function(a){return/^([a-zA-Z0-9?(/\-.,\s{1,})]+)$/.test(a)},trim:function(a){return a.replace(/^\s+|\s+$/g,"")},searchReplace:function(a,
c,b){return a.replace(RegExp(c,"g"),b)}}}(),u=function(){var d=function(c){a.browser.msie||(a.browser.mozilla&&1<=parseInt(a.browser.version)?console.log(c):a.browser.webkit&&534<=parseInt(a.browser.version)?console.log(c):a.browser.opera&&11<=parseInt(a.browser.version)&&console.log(c))};return{info:function(a){d("Info :: "+a)},raw:function(a){d(a)},warn:function(a){d("Warning :: "+a)},error:function(a){d("Error :: "+a)},fatal:function(a){d("Fatal :: "+a)}}}(),F=function(){return{alertError:function(d){function c(b,
c){b.preventDefault();var d=a(c).closest("div.cgmp-popup-shortcode-dialog");d&&a(d).remove();0==a("div.cgmp-popup-shortcode-dialog").length&&a("#cgmp-popup-mask").remove()}var b=a('<div id="cgmp-popup-mask"/>'),g=Math.random().toString(36).substring(3),l=a('<div id="'+g+'" class="cgmp-popup-shortcode-dialog cgmp-popup-window">');l.html("<div class='dismiss-container'><a class='dialog-dismiss' href='javascript:void(0)'>\u00d7</a></div><p style='text-align: left; padding: 10px 10px 0 10px'>"+d+"</p><div align='center'><input type='button' class='close-dialog' value='Close' /></div>");
a("body").append(b);a("body").append(l);d=a(document).height();b=a(window).width();a("#cgmp-popup-mask").css({width:b,height:d,opacity:0.1});1==a("#cgmp-popup-mask").length&&a("#cgmp-popup-mask").show();d=a(window).height();b=a(window).width();a("div#"+g).css("top",d/2-a("div#"+g).height()/2);a("div#"+g).css("left",b/2-a("div#"+g).width()/2);a("div#"+g).fadeIn(500);a(".cgmp-popup-window .close-dialog").click(function(b){c(b,a(this))});a(".cgmp-popup-window .dialog-dismiss").click(function(b){c(b,
a(this))});a("#cgmp-popup-mask").click(function(){a(this).remove();a(".cgmp-popup-window").remove()});a(window).resize(function(){var b=a(".window"),c=a(document).height(),d=a(window).width();a("#cgmp-popup-mask").css({width:d,height:c});c=a(window).height();d=a(window).width();b.css("top",c/2-b.height()/2);b.css("left",d/2-b.width()/2)})}}}();if(0!=a("object#global-data-placeholder").length){var t=document.head||document.getElementsByTagName("head")[0]||document.documentElement,q=document.createElement("link");
q.type="text/css";q.rel="stylesheet";q.href=a("object#global-data-placeholder").find("param#cssHref").val();q.media="screen";t.appendChild(q);d.sep=a("object#global-data-placeholder").find("param#sep").val();d.customMarkersUri=a("object#global-data-placeholder").find("param#customMarkersUri").val();d.errors=a("object#global-data-placeholder").find("param#errors").val();d.errors=y(d.errors);d.translations=a("object#global-data-placeholder").find("param#translations").val();d.translations=y(d.translations);
t=parseFloat(a.fn.jquery.split(".")[0]);q=parseFloat(a.fn.jquery.split(".")[1]);if(1>t||1<=t&&2>t&&3>q)return alert(d.errors.oldJquery),!1;if("undefined"==typeof google||!google)return F.alertError(d.errors.msgNoGoogle),!1;if("undefined"!=typeof GMap2&&GMap2)return F.alertError(d.errors.msgApiV2),!1;d.language=a("object#global-data-placeholder").find("param#language").val();google.load("maps","3",{other_params:"sensor=false&libraries=panoramio&language="+d.language,callback:function(){g()}})}})("undefined"!==
typeof g&&null!=g&&g?g:jQuery)}if("undefined"===typeof jQuery||null==jQuery){var L=!1,r=document.head||document.getElementsByTagName("head")[0]||document.documentElement,g=document.createElement("script");g.type="text/javascript";g.src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js";g.onload=g.onreadystatechange=function(){if(!L&&(!this.readyState||/loaded|complete/.test(g.readyState))){L=!0;var W=jQuery.noConflict();x(W);g.onload=g.onreadystatechange=null;r&&g.parentNode&&r.removeChild(g);
g=void 0}};r.appendChild(g)}else x()})();
